<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trade Pilot - Christian Hohlfeld</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- BASE SETTINGS --- */
        body { 
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; 
            user-select: none; 
            overflow: hidden; 
            background-color: #020617; 
            color: #f1f5f9; 
            -webkit-tap-highlight-color: transparent;
            height: 100vh; width: 100vw;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- 3D CARD ENGINE --- */
        .scene { 
            perspective: 1200px; z-index: 20; position: relative; 
            width: 100%; max-width: 420px; height: 85vh; max-height: 780px; min-height: 600px;
        }
        .card {
            position: relative; width: 100%; height: 100%;
            transform-style: preserve-3d; 
            transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .card.is-flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; -webkit-backface-visibility: hidden;
            border-radius: 1.75rem; 
            overflow: hidden;
            background-color: rgba(30, 41, 59, 0.95); 
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 60px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255,255,255,0.05) inset;
            backdrop-filter: blur(16px);
            display: flex; flex-direction: column;
        }
        .card-face-front { z-index: 2; transform: rotateY(0deg); }
        .card-face-back { transform: rotateY(180deg); background-color: rgba(15, 23, 42, 0.98); }

        /* --- BACKGROUND CANVAS --- */
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; touch-action: none; }
        .bg-vignette {
            position: fixed; inset: 0; z-index: 1; pointer-events: none;
            background: radial-gradient(circle at center, rgba(2,6,23,0.3) 0%, rgba(2,6,23,0.95) 90%);
        }

        /* --- INTERACTIONS (NO SCALE) --- */
        .interactive {
            cursor: pointer; 
            transition: opacity 0.1s, background-color 0.1s;
        }
        .interactive:active { opacity: 0.8; }

        /* Ripple */
        .ripple { 
            position: absolute; border-radius: 50%; transform: scale(0); 
            animation: ripple 0.5s ease-out; 
            background-color: rgba(255, 255, 255, 0.1); pointer-events: none; 
        }
        @keyframes ripple { to { transform: scale(3); opacity: 0; } }

        /* --- CONTROLS STYLING --- */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        input[type="datetime-local"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; opacity: 0.6; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #10B981; border: 2px solid #064E3B; 
            cursor: grab; margin-top: -8px; 
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); 
            transition: transform 0.1s ease;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.1); cursor: grabbing; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }

        /* Animations */
        .pulse-text { animation: textPulse 0.4s ease-out; }
        @keyframes textPulse { 
            0% { color: #fff; transform: scale(1); } 
            50% { color: #34d399; transform: scale(1.05); } 
            100% { color: #fff; transform: scale(1); } 
        }

        .loader { border: 2px solid #334155; border-top: 2px solid #10B981; border-radius: 50%; width: 16px; height: 16px; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Scrollbar */
        .content-scroll { overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; }
        .content-scroll::-webkit-scrollbar { width: 4px; }
        .content-scroll::-webkit-scrollbar-track { background: transparent; }
        .content-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }

        /* Toggle */
        .toggle-track { transition: background-color 0.2s ease; }
        .toggle-knob { transition: transform 0.2s cubic-bezier(0.4, 0.0, 0.2, 1); }
        .toggle-checkbox:checked ~ .toggle-track { background-color: #10B981; }
        .toggle-checkbox:checked ~ .toggle-knob { transform: translateX(100%); background-color: white; }

        .hidden { display: none !important; }

        /* Toast */
        #toast-container { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { 
            background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(12px); 
            color: #fff; padding: 10px 20px; border-radius: 99px; 
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1);
            font-size: 13px; font-weight: 500; opacity: 0; transform: translateY(20px); 
            transition: all 0.3s ease-out; pointer-events: auto; 
            display: flex; align-items: center; gap: 10px; 
        }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* Modals */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 9998; display: none; opacity: 0; transition: opacity 0.3s; }
        .modal-backdrop.show { opacity: 1; }
        .action-sheet { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(120%); 
            background: #1e293b; width: 92%; max-width: 400px; padding: 24px; 
            border-radius: 28px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7); border: 1px solid #334155;
            z-index: 9999; transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); 
            display: none; flex-direction: column; gap: 16px; text-align: center; color: white;
        }
        .action-sheet.show { transform: translateX(-50%) translateY(0); }

        .btn-action { padding: 12px; border-radius: 14px; font-weight: 600; font-size: 14px; width: 100%; cursor: pointer; transition: background-color 0.2s; }
        .btn-primary { background-color: #10B981; color: white; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .btn-primary:hover { background-color: #059669; }
        .btn-secondary { background-color: #334155; color: #cbd5e1; border: 1px solid #475569; }
        .btn-secondary:hover { background-color: #475569; }
        .btn-danger { background-color: #450a0a; color: #fca5a5; border: 1px solid #7f1d1d; }
        .btn-danger:hover { background-color: #7f1d1d; }

        #privacy-reset-btn { position: fixed; bottom: 20px; left: 20px; background-color: rgba(30, 41, 59, 0.8); border: 1px solid #475569; border-radius: 99px; padding: 8px 16px; cursor: pointer; z-index: 60; display: none; font-size: 11px; color: #94a3b8; transition: all 0.2s; align-items: center; gap: 6px; backdrop-filter: blur(8px); }
        #privacy-reset-btn:hover { color: #ef4444; border-color: #fca5a5; }
        
        /* Chart Tooltip */
        #chart-tooltip {
            position: absolute; pointer-events: none; z-index: 10;
            background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 6px 10px; border-radius: 8px; font-size: 11px; font-family: monospace;
            white-space: nowrap; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        
        /* Badges */
        .stock-badge {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 4px 10px; border-radius: 12px; font-size: 10px; color: #94a3b8;
            cursor: pointer; transition: all 0.2s; font-family: monospace;
        }
        .stock-badge:hover { background: rgba(16, 185, 129, 0.1); color: #34d399; border-color: rgba(16, 185, 129, 0.3); }
    </style>
</head>
<body>

    <!-- Background Chart System -->
    <canvas id="bg-canvas"></canvas>
    <div class="bg-vignette"></div>
    <div id="chart-tooltip"></div>

    <!-- Toast -->
    <div id="toast-container"></div>

    <!-- Modals -->
    <div id="modal-backdrop" class="modal-backdrop"></div>
    <div id="generic-modal" class="action-sheet">
        <div id="modal-icon" class="mx-auto w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-2xl border border-slate-700"></div>
        <div>
            <h2 id="modal-title" class="text-xl font-bold text-white"></h2>
            <p id="modal-text" class="text-sm text-slate-400 mt-2 leading-relaxed"></p>
        </div>
        <div id="modal-actions" class="flex flex-col gap-3 w-full"></div>
    </div>

    <!-- Consent Pause Screen -->
    <div id="consent-pause-screen" class="hidden fixed inset-0 bg-gray-950 z-[9999] flex flex-col items-center justify-center text-center p-6">
        <div class="max-w-xs w-full">
            <div class="text-5xl mb-6">ðŸ”’</div>
            <h3 class="text-2xl font-bold text-white mb-2">Gesperrt</h3>
            <p class="text-slate-400 text-sm mb-8">Die App benÃ¶tigt lokalen Speicherzugriff.</p>
            <button onclick="decideConsent(true)" class="btn-action btn-primary">Freigeben</button>
        </div>
    </div>

    <!-- 3D SCENE -->
    <div class="scene">
        <div class="card" id="main-card">
            
            <!-- FRONT -->
            <div class="card-face card-face-front shadow-2xl">
                
                <!-- Header (Fixed) -->
                <div class="p-5 pb-3 flex justify-between items-start border-b border-gray-700/50 bg-slate-800/30 backdrop-blur-md flex-shrink-0">
                    <div class="flex items-center gap-3">
                        <button onclick="toggleFlip()" class="interactive p-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white transition-colors border border-gray-700/50" title="Historie [Leertaste]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
                        </button>
                        <div>
                            <h1 class="text-xl font-bold tracking-tight text-white">Trade Pilot</h1>
                            <!-- User Name + Logout -->
                            <div class="flex items-center gap-2 group cursor-pointer" onclick="logout()">
                                <p class="text-slate-500 text-[10px] font-bold tracking-widest uppercase group-hover:text-slate-300 transition-colors" id="user-display-name">Christian Heinrich Hohlfeld</p>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-slate-600 group-hover:text-red-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <a id="yahooLink" href="https://finance.yahoo.com" target="_blank" class="interactive p-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-emerald-400 transition-colors border border-gray-700/50" title="Yahoo Finance">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                    </a>
                </div>

                <!-- Content (Scrollable) -->
                <div class="flex-1 content-scroll p-5 space-y-4 bg-slate-900/30">
                    
                    <!-- Login Overlay -->
                    <div id="login-overlay" class="absolute inset-0 bg-slate-900 z-50 flex flex-col justify-center p-8 text-center hidden">
                        <div class="w-20 h-20 rounded-3xl bg-slate-800 mx-auto flex items-center justify-center mb-6 shadow-lg border border-slate-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Willkommen</h2>
                        <input type="text" id="username-input" placeholder="Ihr Name" class="w-full bg-slate-800 border border-slate-700 rounded-xl p-4 text-white mb-4 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 text-center transition-all">
                        <button onclick="performLogin()" class="btn-action btn-primary shadow-lg">Starten</button>
                    </div>

                    <!-- Search -->
                    <div class="space-y-2">
                        <div class="relative z-20 group bg-slate-800/50 rounded-xl border border-white/10 focus-within:border-emerald-500/50 focus-within:bg-slate-800 transition-colors">
                            <div class="flex items-center">
                                <div class="pl-4 text-slate-500"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div>
                                <input type="text" id="searchInput" placeholder="Aktie suchen..." class="flex-1 p-3 bg-transparent border-none outline-none text-slate-200 placeholder-slate-600 font-medium text-sm" onkeydown="if(event.key === 'Enter') searchStock()">
                            </div>
                            <div id="searchResults" class="hidden absolute top-full left-0 w-full bg-slate-800 shadow-2xl border border-slate-700 rounded-xl mt-2 max-h-60 overflow-y-auto z-50 divide-y divide-slate-700"></div>
                            <div id="loadingIndicator" class="hidden absolute right-4 top-3"><span class="loader"></span></div>
                        </div>
                        <!-- Recent Searches (Badges) -->
                        <div id="recent-searches" class="flex flex-wrap gap-2 pl-1">
                            <!-- Badges injected here -->
                        </div>
                    </div>

                    <!-- Inputs -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-800/40 p-3 rounded-xl border border-white/5 hover:border-white/10 transition-colors interactive">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-0.5">Kaufkurs</label>
                            <div class="flex items-baseline gap-1">
                                <input type="number" id="buyPrice" value="258.00" step="0.01" class="w-full bg-transparent p-0 text-right font-mono text-lg font-bold text-white outline-none" oninput="saveAndCalc()">
                                <span class="text-xs text-slate-500 font-bold">â‚¬</span>
                            </div>
                        </div>
                        <div class="bg-slate-800/40 p-3 rounded-xl border border-white/5 hover:border-white/10 transition-colors interactive">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-0.5">Anzahl</label>
                            <input type="number" id="quantity" value="2" step="1" class="w-full bg-transparent p-0 text-right font-mono text-lg font-bold text-white outline-none" oninput="saveAndCalc()">
                        </div>
                        <div class="col-span-2 bg-slate-800/40 p-2.5 px-3 rounded-xl border border-white/5 hover:border-white/10 transition-colors flex justify-between items-center interactive">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Kaufdatum</label>
                            <input type="datetime-local" id="purchaseDate" class="bg-transparent border-none p-0 text-right font-mono text-xs font-medium text-slate-300 outline-none tracking-wide">
                        </div>
                    </div>

                    <!-- Settings Box -->
                    <div class="bg-slate-800/30 p-4 rounded-2xl border border-white/5">
                        <div class="flex justify-between items-center mb-4">
                            <!-- Tax Toggle -->
                            <label class="flex items-center cursor-pointer gap-2 select-none group interactive" onclick="AudioEngine.playImpact('plastic')">
                                <div class="relative w-9 h-5">
                                    <input type="checkbox" id="taxToggle" class="peer sr-only" onchange="handleToggle()">
                                    <div class="w-full h-full bg-slate-600 rounded-full shadow-inner peer-checked:bg-emerald-500 transition-colors duration-200"></div>
                                    <div class="absolute left-0.5 top-0.5 bg-white w-4 h-4 rounded-full shadow transition-transform duration-200 peer-checked:translate-x-[1rem]"></div>
                                </div>
                                <span class="text-[11px] font-bold text-slate-500 uppercase tracking-wide group-hover:text-slate-300 transition-colors">Steuer</span>
                            </label>

                            <!-- Profit Mode Toggle -->
                            <label class="flex items-center cursor-pointer gap-2 select-none group interactive" onclick="AudioEngine.playImpact('plastic')">
                                <span class="text-[11px] font-bold text-slate-500 uppercase tracking-wide group-hover:text-slate-300 transition-colors" id="profitModeLabel">Gewinn in â‚¬</span>
                                <div class="relative w-9 h-5">
                                    <input type="checkbox" id="profitModeToggle" class="peer sr-only" onchange="toggleProfitMode()">
                                    <div class="w-full h-full bg-slate-600 rounded-full shadow-inner peer-checked:bg-emerald-500 transition-colors duration-200"></div>
                                    <div class="absolute left-0.5 top-0.5 bg-white w-4 h-4 rounded-full shadow transition-transform duration-200 peer-checked:translate-x-[1rem]"></div>
                                </div>
                            </label>
                        </div>

                        <div class="flex justify-between items-end mb-2">
                            <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider">Ziel</label>
                            <span class="text-xl font-bold text-emerald-400 font-mono transition-all" id="targetProfitDisplay">0,00 â‚¬</span>
                        </div>
                        <input type="range" id="profitSlider" min="0" max="500" value="0" step="1" class="w-full" oninput="handleSlider(this)">
                    </div>

                    <!-- Result Card -->
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-xl border border-slate-700 relative overflow-hidden group interactive">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 to-emerald-400 opacity-90"></div>
                        <div class="p-5">
                            <div class="flex justify-between items-end mb-1">
                                <div>
                                    <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-0.5">Invest</p>
                                    <p class="text-base font-mono text-slate-300" id="totalInvested">0,00 â‚¬</p>
                                </div>
                                <div class="text-slate-600 mb-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg></div>
                                <div class="text-right">
                                    <p class="text-[10px] text-emerald-500 uppercase tracking-widest mb-0.5">Verkauf</p>
                                    <p class="text-2xl font-bold font-mono text-white tracking-tight drop-shadow-md" id="requiredSellPriceTotal">0,00 â‚¬</p>
                                </div>
                            </div>
                            <div class="border-t border-slate-700/50 mt-3 pt-3 flex justify-between items-center">
                                <span class="text-[11px] text-slate-400">Kurs: <span id="requiredSellPriceShare" class="text-white font-mono font-bold">0,00 â‚¬</span></span>
                                <span id="percentChange" class="text-[11px] font-bold bg-slate-700/50 px-2 py-0.5 rounded text-emerald-400 border border-emerald-500/20">0,00%</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between text-[10px] text-slate-500 px-2">
                        <span>GebÃ¼hren: <span id="totalFees" class="text-slate-400 font-medium">0,00 â‚¬</span></span>
                        <span id="taxInfo" class="opacity-0 transition-opacity duration-300">Steuer: <span id="taxAmount" class="text-red-400 font-medium">0,00 â‚¬</span></span>
                    </div>

                    <button onclick="saveTrade()" class="btn-action btn-secondary bg-slate-800 text-white border-slate-700 shadow-lg flex items-center justify-center gap-2 mt-1 mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>
                        Sichern
                    </button>
                </div>
            </div>

            <!-- BACK: HISTORIE -->
            <div class="card-face card-face-back flex flex-col">
                <div class="p-6 pb-3 border-b border-gray-700/50 flex justify-between items-center bg-slate-800/30 backdrop-blur-md flex-shrink-0">
                    <div class="flex items-center gap-3">
                        <button onclick="toggleFlip()" class="interactive p-2 rounded-full bg-slate-800 hover:bg-slate-700 text-emerald-500 transition-colors border border-slate-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                        </button>
                        <h2 class="text-lg font-bold text-white">Historie</h2>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="exportData()" class="p-2 rounded-lg bg-slate-800 text-slate-400 hover:text-white border border-slate-700 transition-colors interactive" title="Backup"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg></button>
                        <button onclick="document.getElementById('importFile').click()" class="p-2 rounded-lg bg-slate-800 text-slate-400 hover:text-white border border-slate-700 transition-colors interactive" title="Import"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg></button>
                        <input type="file" id="importFile" accept=".json" class="hidden" onchange="importData(this)">
                        <button onclick="askReset()" class="p-2 rounded-lg bg-slate-800 text-slate-400 hover:text-red-400 border border-slate-700 transition-colors interactive" title="Reset All"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                    </div>
                </div>
                <div id="trades-list" class="flex-1 content-scroll p-5 space-y-3"></div>
                <div class="p-3 border-t border-gray-700/50 text-center bg-slate-800/30 flex-shrink-0">
                    <p class="text-[9px] text-slate-500 uppercase tracking-widest">Christian Heinrich Hohlfeld Software</p>
                </div>
            </div>

        </div>
    </div>

    <button id="privacy-reset-btn" onclick="revokeConsent()">Reset</button>

    <script>
        // === 1. AUDIO ENGINE ===
        const AudioEngine = {
            ctx: null, masterGain: null,
            init: function() {
                if (!this.ctx) {
                    const AC = window.AudioContext || window.webkitAudioContext;
                    this.ctx = new AC(); this.masterGain = this.ctx.createGain();
                    this.masterGain.gain.value = 0.15; this.masterGain.connect(this.ctx.destination);
                }
                if (this.ctx.state === 'suspended') this.ctx.resume();
            },
            playImpact: function(mat) {
                this.init(); const now = this.ctx.currentTime; const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                if (mat === 'glass') { o.type='sine'; o.frequency.setValueAtTime(400, now); g.gain.setValueAtTime(0.05, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.1); }
                else if (mat === 'plastic') { o.type='triangle'; o.frequency.setValueAtTime(200, now); g.gain.setValueAtTime(0.06, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.1); }
                else { o.type='sine'; o.frequency.setValueAtTime(80, now); g.gain.setValueAtTime(0.08, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.15); }
                o.connect(g); g.connect(this.masterGain); o.start(now); o.stop(now+0.2);
            },
            playTick: function() { 
                this.init(); const now = this.ctx.currentTime; const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                o.type='sine'; o.frequency.setValueAtTime(300, now); 
                g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.1, now+0.005); g.gain.exponentialRampToValueAtTime(0.001, now+0.05);
                o.connect(g); g.connect(this.masterGain); o.start(now); o.stop(now+0.06);
            },
            playSuccess: function() {
                this.init(); const now = this.ctx.currentTime; [523.25, 783.99].forEach(f => {
                    const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                    o.type='sine'; o.frequency.value=f; g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.1, now+0.05); g.gain.exponentialRampToValueAtTime(0.001, now+1.5);
                    o.connect(g); g.connect(this.masterGain); o.start(now); o.stop(now+1.5);
                });
            },
            playSwoosh: function() {
                this.init(); const now = this.ctx.currentTime; const b = this.ctx.createBuffer(1, this.ctx.sampleRate*0.3, this.ctx.sampleRate);
                const d = b.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
                const s = this.ctx.createBufferSource(); s.buffer=b;
                const f = this.ctx.createBiquadFilter(); f.type='lowpass'; f.frequency.setValueAtTime(400, now); f.frequency.exponentialRampToValueAtTime(50, now+0.3);
                const g = this.ctx.createGain(); g.gain.setValueAtTime(0.1, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.3);
                s.connect(f); f.connect(g); g.connect(this.masterGain); s.start(now);
            }
        };

        // === 2. INTERACTIONS ===
        document.addEventListener('mousedown', (e) => {
            const r = document.createElement("div"); r.className = "ripple";
            r.style.left = (e.clientX-10)+"px"; r.style.top = (e.clientY-10)+"px"; r.style.width="20px"; r.style.height="20px";
            document.body.appendChild(r); setTimeout(()=>r.remove(), 500);
            const t = e.target; let mat = 'soft';
            if(t.closest('input, textarea')) mat='glass'; else if(t.closest('.interactive, button, label')) mat='plastic';
            if(t.tagName!=='INPUT' || t.type!=='range') AudioEngine.playImpact(mat);
        });
        document.addEventListener('keydown', (e) => { if(e.code==='Space' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) { e.preventDefault(); toggleFlip(); } });

        // === 3. APP STATE & CONFIG ===
        const KEYS = { C:'ing_cons', U:'ing_user', D:'ing_data', T:'ing_trade', H:'ing_history' };
        let profitMode = 'EUR';
        let chartData = null;

        function toggleFlip() { AudioEngine.playSwoosh(); document.getElementById('main-card').classList.toggle('is-flipped'); }
        
        // Exposed Functions
        window.initConsent = function() {
            const s = localStorage.getItem(KEYS.C);
            const o=document.getElementById('consent-overlay'), b=document.getElementById('consent-initial-backdrop'), p=document.getElementById('consent-pause-screen'), r=document.getElementById('privacy-reset-btn');
            document.body.style.overflow='auto';
            if(s==='true') { if(o)o.style.display='none'; if(b)b.style.display='none'; if(p)p.classList.add('hidden'); if(r)r.style.display='block'; checkLogin(); }
            else if(s==='false') { if(o)o.style.display='none'; if(b)b.style.display='none'; if(p)p.classList.remove('hidden'); }
            else { showModal('consent', 'Datenschutz', 'Wir speichern Daten lokal.', [{label:'Akzeptieren', cls:'btn-action btn-primary', cb:()=>window.decideConsent(true)}, {label:'Ablehnen', cls:'btn-action btn-secondary', cb:()=>window.decideConsent(false)}]); }
        };
        window.decideConsent = function(a) { localStorage.setItem(KEYS.C, a?'true':'false'); if(a) { AudioEngine.playImpact('plastic'); window.initConsent(); } else { location.reload(); } };
        window.askReset = function() { showModal('warn', 'LÃ¶schen?', 'Alle Daten lÃ¶schen?', [{label:'LÃ¶schen', cls:'btn-action btn-danger', cb:()=>{localStorage.clear();location.reload();}}, {label:'Abbrechen', cls:'btn-action btn-secondary'}]); };

        function checkLogin() {
            const u = localStorage.getItem(KEYS.U);
            const ov = document.getElementById('login-overlay');
            if(u) { ov.classList.add('hidden'); document.getElementById('user-display-name').textContent = u; loadState(); renderTrades(); updateRecentsUI(); }
            else { ov.classList.remove('hidden'); document.getElementById('username-input').value = "Christian Heinrich Hohlfeld"; }
        }
        window.performLogin = function() { localStorage.setItem(KEYS.U, document.getElementById('username-input').value.trim()||"Anonym"); AudioEngine.playSuccess(); checkLogin(); };
        window.logout = function() { localStorage.removeItem(KEYS.U); location.reload(); };

        function loadState() {
            const now = new Date(); now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('purchaseDate').value = now.toISOString().slice(0,16);
            const r = localStorage.getItem(KEYS.D);
            if(!r) { calculate(); return; }
            try {
                const d = JSON.parse(r);
                if(d.bp) document.getElementById('buyPrice').value = d.bp;
                if(d.qty) document.getElementById('quantity').value = d.qty;
                if(d.sym) { document.getElementById('searchInput').value = d.sym; fetchPrice(d.sym); }
                if(d.ps) document.getElementById('profitSlider').value = d.ps;
                if(d.tt!==undefined) { document.getElementById('taxToggle').checked = d.tt; handleToggle(false); }
                if(d.pm) { document.getElementById('profitModeToggle').checked = (d.pm==='PERCENT'); toggleProfitMode(false); }
                calculate();
            } catch(e) {}
        }
        window.saveState = function() {
            if(localStorage.getItem(KEYS.C)!=='true') return;
            const d = {
                bp: document.getElementById('buyPrice').value, qty: document.getElementById('quantity').value,
                ps: document.getElementById('profitSlider').value, tt: document.getElementById('taxToggle').checked,
                sym: document.getElementById('searchInput').value,
                pm: document.getElementById('profitModeToggle').checked ? 'PERCENT' : 'EUR'
            };
            localStorage.setItem(KEYS.D, JSON.stringify(d));
        }
        window.saveAndCalc = function() { calculate(); saveState(); };

        // === LOGIC ===
        const fmt = (n) => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(n);
        const calcFee = (v) => { let f = 4.90 + (v*0.0025); return f>69.90?69.90:f; };
        let prevRes = 0;

        window.toggleProfitMode = function(calc = true) {
            const chk = document.getElementById('profitModeToggle');
            profitMode = chk.checked ? 'PERCENT' : 'EUR';
            const slider = document.getElementById('profitSlider');
            document.getElementById('profitModeLabel').textContent = chk.checked ? "Gewinn in %" : "Gewinn in â‚¬";
            if (chk.checked) { slider.max = 100; slider.step = 0.5; } else { slider.max = 500; slider.step = 1; }
            if (calc) calculate();
        };
        window.handleToggle = function(sound=true) {
            const c = document.getElementById('taxToggle');
            document.getElementById('taxInfo').style.opacity = c.checked ? '1' : '0';
            saveAndCalc();
        };
        window.handleSlider = function(el) {
            const now = Date.now();
            if(!el.ls || (now-el.ls)>40) { if(el.value!=el.lv) { AudioEngine.playTick(); el.ls=now; el.lv=el.value; } }
            calculate();
        }

        function calculate() {
            const bp = parseFloat(document.getElementById('buyPrice').value)||0;
            const qty = parseFloat(document.getElementById('quantity').value)||0;
            const slider = parseFloat(document.getElementById('profitSlider').value)||0;
            const useTax = document.getElementById('taxToggle').checked;
            const invest = (bp*qty) + calcFee(bp*qty);
            let netTarget = (profitMode==='EUR') ? slider : (invest * (slider/100));
            document.getElementById('targetProfitDisplay').textContent = (profitMode==='EUR') ? fmt(netTarget) : `${slider.toFixed(1)} % (${fmt(netTarget)})`;
            if(bp<=0 || qty<=0) { renderCanvas(); return; }

            let grossTarget = netTarget; if(useTax && netTarget>0) grossTarget = netTarget / (1 - 0.26375);
            const payout = invest + grossTarget;
            let sellVol = (payout + 4.90) / 0.9975; if(calcFee(sellVol) >= 69.90) sellVol = payout + 69.90;
            const sellFee = calcFee(sellVol);
            const grossProfit = sellVol - sellFee - invest;
            const taxVal = (useTax && grossProfit > 0) ? grossProfit * 0.26375 : 0;
            const reqPrice = sellVol / qty;
            const pct = ((reqPrice - bp) / bp) * 100;
            const el = document.getElementById('requiredSellPriceTotal');
            if(Math.abs(sellVol - prevRes) > 0.01) { el.classList.remove('pulse-text'); void el.offsetWidth; el.classList.add('pulse-text'); prevRes = sellVol; }
            el.textContent = fmt(sellVol);
            document.getElementById('requiredSellPriceShare').textContent = fmt(reqPrice);
            document.getElementById('totalInvested').textContent = fmt(invest);
            document.getElementById('percentChange').textContent = `+${pct.toFixed(2)} %`;
            document.getElementById('totalFees').textContent = fmt(calcFee(bp*qty) + sellFee);
            document.getElementById('taxAmount').textContent = fmt(taxVal);
            renderCanvas(); // State-driven render
        }

        // === TRADES & SEARCH ===
        window.saveTrade = function() {
            if(localStorage.getItem(KEYS.C)!=='true') return;
            const t = { id: Date.now(), sym: document.getElementById('searchInput').value || "Manuell", date: document.getElementById('purchaseDate').value, qty: document.getElementById('quantity').value, tgt: document.getElementById('requiredSellPriceTotal').innerText };
            const l = JSON.parse(localStorage.getItem(KEYS.T)||'[]'); l.unshift(t);
            localStorage.setItem(KEYS.T, JSON.stringify(l)); AudioEngine.playSuccess(); showToast("Gespeichert"); renderTrades();
        };
        function renderTrades() {
            const l = JSON.parse(localStorage.getItem(KEYS.T)||'[]');
            const el = document.getElementById('trades-list');
            if(l.length===0) { el.innerHTML='<div class="text-center text-gray-600 text-xs italic mt-10">Keine EintrÃ¤ge.</div>'; return; }
            el.innerHTML = l.map(x => `<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-4 flex justify-between items-center interactive"><div><div class="flex items-center gap-2 mb-1"><span class="bg-gray-700 text-white text-[10px] font-bold px-1.5 py-0.5 rounded">${x.sym}</span><span class="text-slate-400 text-[10px]">${new Date(x.date).toLocaleDateString()}</span></div><div class="text-xs text-gray-300 font-mono">Ziel: <span class="text-emerald-400 font-bold">${x.tgt}</span></div></div><button onclick="delTrade(${x.id})" class="text-slate-500 hover:text-red-400 p-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div>`).join('');
        }
        window.delTrade = function(id) { showModal('warn', 'LÃ¶schen?', 'Entfernen?', [{label:'LÃ¶schen', cls:'btn-action btn-danger', cb:()=>{ let l=JSON.parse(localStorage.getItem(KEYS.T)||'[]'); l=l.filter(x=>x.id!==id); localStorage.setItem(KEYS.T,JSON.stringify(l)); renderTrades(); }}, {label:'Abbrechen', cls:'btn-action btn-secondary'}]); };

        function addToRecents(sym) {
            let h = JSON.parse(localStorage.getItem(KEYS.H)||'[]');
            h = h.filter(i => i !== sym); h.unshift(sym);
            if(h.length > 3) h.pop();
            localStorage.setItem(KEYS.H, JSON.stringify(h));
            updateRecentsUI();
        }
        function updateRecentsUI() {
            const h = JSON.parse(localStorage.getItem(KEYS.H)||'[]');
            const c = document.getElementById('recent-searches');
            c.innerHTML = h.map(s => `<span class="stock-badge" onclick="fetchPrice('${s}')">${s}</span>`).join('');
        }

        const PX = [ {u:t=>`https://corsproxy.io/?${encodeURIComponent(t)}`, e:d=>d}, {u:t=>`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`, e:d=>JSON.parse(d.contents)} ];
        async function fetchSafe(u) {
            for(let p of PX) { try {
                const c = new AbortController(); setTimeout(()=>c.abort(),3000);
                const r = await fetch(p.u(u), {signal:c.signal}); if(!r.ok) throw 1; return p.e(await r.json());
            } catch(e){} } throw "Err";
        }
        window.searchStock = async function() {
            const q=document.getElementById('searchInput').value; if(!q)return;
            const r=document.getElementById('searchResults'), l=document.getElementById('loadingIndicator');
            r.innerHTML=''; r.classList.add('hidden'); l.classList.remove('hidden');
            try {
                const d = await fetchSafe(`https://query1.finance.yahoo.com/v1/finance/search?q=${q}&quotesCount=5`);
                l.classList.add('hidden');
                if(d.quotes?.length) {
                    r.classList.remove('hidden');
                    d.quotes.forEach(s => {
                        const div = document.createElement('div');
                        div.className="p-3 hover:bg-gray-800 cursor-pointer border-b border-gray-700 flex justify-between items-center interactive";
                        div.innerHTML=`<div><div class="font-bold text-gray-200 text-sm">${s.symbol}</div><div class="text-[10px] text-gray-500">${s.shortname||s.longname}</div></div>`;
                        div.onmousedown=(e)=>{e.preventDefault(); fetchPrice(s.symbol);}; r.appendChild(div);
                    });
                } else showToast("Nichts gefunden");
            } catch(e){ l.classList.add('hidden'); showToast("Fehler"); }
        };
        async function fetchPrice(s) {
            document.getElementById('searchResults').classList.add('hidden'); document.getElementById('searchInput').value=s;
            document.getElementById('loadingIndicator').classList.remove('hidden');
            try {
                const d = await fetchSafe(`https://query1.finance.yahoo.com/v8/finance/chart/${s}?range=max&interval=1mo`);
                const p = d.chart?.result?.[0]?.meta?.regularMarketPrice;
                if(d.chart?.result?.[0]?.indicators?.quote?.[0]?.close) {
                    const q = d.chart.result[0].indicators.quote[0].close;
                    const t = d.chart.result[0].timestamp;
                    chartData = { quotes: q.filter(n=>n!==null), stamps: t.filter((_,i)=>q[i]!==null) };
                }
                if(p) { AudioEngine.playSuccess(); document.getElementById('buyPrice').value=p.toFixed(2); document.getElementById('yahooLink').href=`https://finance.yahoo.com/quote/${s}`; addToRecents(s); saveAndCalc(); }
            } catch(e){ showToast("Kein Kurs"); } finally { document.getElementById('loadingIndicator').classList.add('hidden'); }
        }

        // === CHART RENDERING (Pure & Safe) ===
        function renderCanvas(mouseX, mouseY) {
            const canvas = document.getElementById('bg-canvas'); const ctx = canvas.getContext('2d');
            
            // Only resize if dimensions differ (avoids loop)
            if (canvas.width !== window.innerWidth || canvas.height !== window.innerHeight) {
                canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            }
            const w = canvas.width; const h = canvas.height;
            ctx.clearRect(0, 0, w, h);

            if (!chartData || !chartData.quotes.length) return;
            const hist = chartData.quotes;

            // Markers from DOM (Read-only here)
            const bp = parseFloat(document.getElementById('buyPrice').value) || 0;
            const q = parseFloat(document.getElementById('quantity').value) || 1;
            const tpTotal = parseFloat(document.getElementById('requiredSellPriceTotal').innerText.replace('.','').replace(',','.').replace(' â‚¬','')) || 0;
            const tp = tpTotal / (q > 0 ? q : 1);

            // Dynamic Range
            let vals = [...hist]; if(bp>0) vals.push(bp); if(tp>0) vals.push(tp);
            const min = Math.min(...vals) * 0.95; const max = Math.max(...vals) * 1.05; const rng = max - min;
            const step = w / (hist.length - 1);
            const getY = (p) => h - ((p - min) / rng * h * 0.6) - (h * 0.2);

            // Draw Graph
            ctx.beginPath(); ctx.lineWidth = 3; ctx.strokeStyle = '#10B981'; ctx.lineCap = 'round'; ctx.lineJoin = 'round';
            hist.forEach((p, i) => { const x = i*step; const y = getY(p); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
            ctx.stroke();
            
            // Fill
            ctx.lineTo(w, h); ctx.lineTo(0, h); ctx.closePath();
            const grad = ctx.createLinearGradient(0, 0, 0, h); grad.addColorStop(0, 'rgba(16, 185, 129, 0.1)'); grad.addColorStop(1, 'rgba(16, 185, 129, 0)');
            ctx.fillStyle = grad; ctx.fill();

            // Markers (Static or Hover)
            if(mouseX !== undefined) {
                const idx = Math.round(mouseX / step);
                if(idx >= 0 && idx < hist.length) {
                    const p = hist[idx]; const x = idx * step; const y = getY(p);
                    const tt = document.getElementById('chart-tooltip');
                    tt.style.display = 'block'; tt.style.left = (x+15)+'px'; tt.style.top = y+'px';
                    if(mouseX > w-150) tt.style.left = (x-15)+'px'; tt.style.transform = mouseX > w-150 ? 'translate(-100%, -50%)' : 'translate(0, -50%)';
                    tt.innerHTML = `${p.toFixed(2)}â‚¬<br><span class="text-slate-400 text-[9px]">${new Date(chartData.stamps[idx]*1000).toLocaleDateString()}</span>`;
                    ctx.beginPath(); ctx.fillStyle = '#fff'; ctx.arc(x, y, 5, 0, Math.PI*2); ctx.fill();
                }
            } else {
                if(bp > 0) { const by = getY(bp); ctx.beginPath(); ctx.setLineDash([4,4]); ctx.strokeStyle='#94a3b8'; ctx.lineWidth=1; ctx.moveTo(0,by); ctx.lineTo(w,by); ctx.stroke(); ctx.setLineDash([]); ctx.beginPath(); ctx.fillStyle='#64748b'; ctx.arc(w-20, by, 4, 0, Math.PI*2); ctx.fill(); }
                if(tp > 0) { const ty = getY(tp); ctx.beginPath(); ctx.strokeStyle='#10b981'; ctx.lineWidth=1; ctx.moveTo(0,ty); ctx.lineTo(w,ty); ctx.stroke(); ctx.beginPath(); ctx.fillStyle='#10b981'; ctx.arc(w-20, ty, 6, 0, Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.fillStyle='rgba(16,185,129,0.3)'; ctx.arc(w-20, ty, 12, 0, Math.PI*2); ctx.fill(); }
            }
        }

        // Hover Event
        document.addEventListener('mousemove', (e) => {
            if(e.target.classList.contains('bg-overlay') || e.target.id==='bg-canvas') renderCanvas(e.clientX, e.clientY);
            else { document.getElementById('chart-tooltip').style.display='none'; renderCanvas(); }
        });

        // Export/Import
        window.exportData = function() {
            const d = { u:localStorage.getItem(KEYS.U), s:JSON.parse(localStorage.getItem(KEYS.D)), t:JSON.parse(localStorage.getItem(KEYS.T)) };
            const a = document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(d)],{type:'application/json'}));
            a.download=`Backup.json`; a.click();
        }
        window.importData = function(i) {
            const f=i.files[0]; if(!f)return; const r=new FileReader();
            r.onload=e=>{ try{ const d=JSON.parse(e.target.result); if(d.u)localStorage.setItem(KEYS.U,d.u); if(d.s)localStorage.setItem(KEYS.D,JSON.stringify(d.s)); if(d.t)localStorage.setItem(KEYS.T,JSON.stringify(d.t)); location.reload(); }catch(x){ showToast("Fehler"); }}; r.readAsText(f);
        }
        function showToast(msg) {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div'); t.className = 'toast';
            t.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg><span>${msg}</span>`;
            c.appendChild(t); requestAnimationFrame(()=>t.classList.add('show'));
            setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(), 300); }, 2000);
        }
        function showModal(t, tl, m, acts) {
            const b=document.getElementById('modal-backdrop'), d=document.getElementById('generic-modal');
            document.getElementById('modal-icon').textContent = t==='warn'?'âš ï¸':'ðŸ›¡ï¸';
            document.getElementById('modal-title').textContent = tl; document.getElementById('modal-text').textContent = m;
            const ac = document.getElementById('modal-actions'); ac.innerHTML='';
            acts.forEach(a=>{ const x=document.createElement('button'); x.textContent=a.label; x.className=a.cls; x.onclick=()=>{closeModal(); if(a.cb)a.cb();}; ac.appendChild(x); });
            b.style.display='block'; d.style.display='flex'; requestAnimationFrame(()=>{b.classList.add('show'); d.classList.add('show');});
        }
        function closeModal() {
            const b=document.getElementById('modal-backdrop'), d=document.getElementById('generic-modal');
            b.classList.remove('show'); d.classList.remove('show'); setTimeout(()=>{b.style.display='none'; d.style.display='none';},300);
        }

        document.addEventListener("DOMContentLoaded", window.initConsent);
    </script>
</body>
</html>
